.element {
  flex-basis: calc(
    (100% - кол-во маржинов в строке * значение маржина) / кол-во элементов в
      строке
  );
}

отступ между блоками 30px, к-во элементов в строке 3 ::

1 способ :

1 - делим маржин на 2 (30px / 2 = 15px)
2 - дать такойже маржин родителю (в данном случае ul)
3 - считаем все маржины  (крайние считаются как половина между блоков целые, выходит 3 )

.element {
  flex-basis: calc((100% - 3 * 30px) / 3);
  margin: 15px;
}

2
  -
  способ
  1
  -
  делим
  маржин
  на
  2
  (30px / 2 = 15px)
  2
  -
  дать
  такойже
  маржин
  родителю
  (в данном случае ul)
  3
  -
  считаем
  все
  маржины
  (все у всех блоковб выйдет 3 )
  4
  -
  умножаем
  на
  половину
  от
  нужного
  размера
  маржина
  (15px)
  .element {
  flex-basis: calc((100% - 6 * 15px) / 3);
  margin: 15px;
}
